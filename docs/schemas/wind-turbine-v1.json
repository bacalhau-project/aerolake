{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://aerolake.org/schemas/wind-turbine-v1.json",
  "title": "Wind Turbine Sensor Data",
  "description": "Schema for wind turbine telemetry data with validation rules",
  "version": "1.0.0",
  "type": "object",
  "required": [
    "timestamp",
    "turbine_id",
    "site_id",
    "temperature",
    "humidity",
    "pressure",
    "wind_speed",
    "power_output"
  ],
  "properties": {
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of the reading"
    },
    "turbine_id": {
      "type": "string",
      "pattern": "^WT-[0-9]{4}$",
      "description": "Wind turbine identifier (format: WT-XXXX)"
    },
    "site_id": {
      "type": "string",
      "pattern": "^SITE-[A-Z]{3}$",
      "description": "Site identifier (format: SITE-XXX)"
    },
    "temperature": {
      "type": "number",
      "minimum": -50,
      "maximum": 60,
      "description": "Ambient temperature in Celsius"
    },
    "humidity": {
      "type": "number",
      "minimum": 0,
      "maximum": 100,
      "description": "Relative humidity percentage"
    },
    "pressure": {
      "type": "number",
      "minimum": 800,
      "maximum": 1100,
      "description": "Atmospheric pressure in hPa"
    },
    "wind_speed": {
      "type": "number",
      "minimum": 0,
      "maximum": 50,
      "description": "Wind speed in m/s"
    },
    "wind_direction": {
      "type": "number",
      "minimum": 0,
      "maximum": 360,
      "description": "Wind direction in degrees"
    },
    "rotation_speed": {
      "type": "number",
      "minimum": 0,
      "maximum": 30,
      "description": "Rotor rotation speed in RPM"
    },
    "blade_pitch": {
      "type": "number",
      "minimum": -5,
      "maximum": 90,
      "description": "Blade pitch angle in degrees"
    },
    "generator_temp": {
      "type": "number",
      "minimum": 0,
      "maximum": 120,
      "description": "Generator temperature in Celsius"
    },
    "power_output": {
      "type": "number",
      "minimum": 0,
      "maximum": 5000,
      "description": "Power output in kW"
    },
    "vibration_x": {
      "type": "number",
      "minimum": 0,
      "maximum": 100,
      "description": "Vibration amplitude X-axis in mm/s"
    },
    "vibration_y": {
      "type": "number",
      "minimum": 0,
      "maximum": 100,
      "description": "Vibration amplitude Y-axis in mm/s"
    },
    "vibration_z": {
      "type": "number",
      "minimum": 0,
      "maximum": 100,
      "description": "Vibration amplitude Z-axis in mm/s"
    },
    "anomaly_flag": {
      "type": "integer",
      "minimum": 0,
      "maximum": 1,
      "description": "Anomaly detection flag (0=normal, 1=anomaly)"
    },
    "pipeline_metadata": {
      "type": "object",
      "description": "Metadata about pipeline processing",
      "properties": {
        "pipeline_version": {
          "type": "string",
          "description": "Version of the pipeline that processed this record"
        },
        "pipeline_stage": {
          "type": "string",
          "enum": ["raw", "schematized", "validated", "aggregated", "anomaly"],
          "description": "Pipeline stage that processed this record"
        },
        "processing_timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "When this record was processed"
        },
        "git_sha": {
          "type": "string",
          "pattern": "^[a-f0-9]{40}$",
          "description": "Git commit SHA of the pipeline code"
        },
        "node_id": {
          "type": "string",
          "description": "ID of the node that processed this record"
        },
        "transformation_hash": {
          "type": "string",
          "pattern": "^[a-f0-9]{64}$",
          "description": "SHA256 hash of the transformation logic"
        }
      }
    }
  },
  "additionalProperties": false,
  "dependencies": {
    "rotation_speed": {
      "properties": {
        "wind_speed": {
          "minimum": 3
        }
      },
      "errorMessage": "Rotation requires minimum wind speed of 3 m/s"
    }
  },
  "allOf": [
    {
      "if": {
        "properties": {
          "wind_speed": {
            "minimum": 25
          }
        }
      },
      "then": {
        "properties": {
          "rotation_speed": {
            "maximum": 20
          }
        },
        "errorMessage": "High wind speed requires reduced rotation for safety"
      }
    },
    {
      "if": {
        "properties": {
          "power_output": {
            "minimum": 100
          }
        }
      },
      "then": {
        "properties": {
          "wind_speed": {
            "minimum": 5
          }
        },
        "errorMessage": "Power generation requires sufficient wind speed"
      }
    }
  ]
}