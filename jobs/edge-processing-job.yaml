name: edge-processing-ops
type: ops

tasks:
  - name: process-and-upload-to-s3
    engine:
      type: docker
      params:
        image: ghcr.io/expanso-io/sensor-processor:v1.0.0
        parameters:
          - --config
          - /app/edge-processing-config.yaml
    network:
      type: full
    env:
      AWS_REGION: "us-west-2"
      SQLITE_DB_PATH: "/data/sensor_data/sensor_data.db"
      AWS_CREDENTIALS_DIR: "/expanso_data/credentials"
      STATE_DIR: "/expanso_data/state"
    inputSources:
      # Mount the SQLite database directory
      - source:
          type: localDirectory
          params:
            sourcePath: /opt/sensor/data
            readWrite: false
        target: /data/sensor_data
      - source:
          type: localDirectory
          params:
            sourcePath: /expanso_data
            readWrite: true
        target: /expanso_data

    timeouts:
      queueTimeout: 3600